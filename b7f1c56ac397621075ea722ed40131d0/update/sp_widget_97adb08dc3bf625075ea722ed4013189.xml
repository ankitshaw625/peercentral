<?xml version="1.0" encoding="UTF-8"?><record_update table="sp_widget">
    <sp_widget action="INSERT_OR_UPDATE">
        <category>custom</category>
        <client_script><![CDATA[api.controller=function() {
  /* widget controller */
  var c = this;
	
	c.activeTab = 'all';
	
	// Controller methods
	c.setTab = function(tabName) {
		c.activeTab = tabName;
	};

};


]]></client_script>
        <controller_as>c</controller_as>
        <css>.nav-tabs li a:hover {
	cursor: pointer;
}

.nav-tabs &gt; li &gt; a:focus,
.nav-tabs &gt; li &gt; a:active {
  outline: none;
  box-shadow: none;
}

.nav-tabs &gt; li.active &gt; a {
  border: none;
  border-bottom: 0.2rem solid #2D7524;
}

.nav-tabs &gt; li.analytics &gt; a:focus {
	border: none;
}</css>
        <data_table>sp_instance</data_table>
        <demo_data/>
        <description/>
        <docs/>
        <field_list/>
        <has_preview>true</has_preview>
        <id>top_contributors</id>
        <internal>false</internal>
        <link><![CDATA[function link(scope, element, attrs, controller) {  }]]></link>
        <name>Top Contributors</name>
        <option_schema>[{"hint":"Number of days to consider for recognitions","name":"days","section":"Data","default_value":"90","label":"Days","type":"integer"},{"hint":"Number of users to show on the leaderboard","name":"users","section":"Data","default_value":"3","label":"User Count","type":"integer"}]</option_schema>
        <public>false</public>
        <roles/>
        <script><![CDATA[(function() {

    var all = [],
        given = [],
        received = [];

    var days = options.days || 90; // Default to 90 if not provided
		var userCount = options.users || 3;

    // Aggregate recognitions given by each user
    var gaGiven = new GlideAggregate('x_1794402_peerce_0_peer_recognition');
    gaGiven.addAggregate('COUNT', 'sender');
    gaGiven.addQuery('sys_created_on', '>=', gs.daysAgo(days));
    gaGiven.groupBy('sender');
    gaGiven.addHaving('COUNT', '>', '0');
	gaGiven.orderByAggregate('COUNT', 'sender');
    gaGiven.query();

    while (gaGiven.next()) {

        var sender = gaGiven.sender.toString();
        var senderDisplay = gaGiven.sender.name.toString();

        var givenCount = parseInt(gaGiven.getAggregate('COUNT', 'sender'));

        given.push({
            user: sender,
            displayName: senderDisplay,
            count: givenCount
        });

        all.push({
            user: sender,
            displayName: senderDisplay,
            count: givenCount
        });
    }


    // Aggregate recognitions received by each user
    var gaReceived = new GlideAggregate('x_1794402_peerce_0_recognition_recipient');
    gaReceived.addNotNullQuery('recipient_user');
    gaReceived.addAggregate('COUNT', 'recipient_user');
    gaReceived.addQuery('sys_created_on', '>=', gs.daysAgo(days));
    gaReceived.groupBy('recipient_user');
    gaReceived.addHaving('COUNT', '>', '0');
	gaReceived.orderByAggregate('COUNT', 'recipient_user');
    gaReceived.query();

    while (gaReceived.next()) {
        var recipient = gaReceived.getValue('recipient_user');
        var recipientDisplay = gaReceived.recipient_user.name.toString();

        var receivedCount = parseInt(gaReceived.getAggregate('COUNT', 'recipient_user'));

        received.push({
            user: recipient,
            displayName: recipientDisplay,
            count: receivedCount
        });

        var user = all.find(function(u) {
            return u.user == recipient;
        });

        if (user) {
            user.count += receivedCount;
        } else {
            all.push({
                user: recipient,
                displayName: recipientDisplay,
                count: receivedCount
            });
        }
    }

    // Sort recognitions by total
    all.sort(function(a, b) {
        return b.count - a.count;
    });

    // Limit to top 5
    data.all = all.slice(0, userCount);
    data.given = given.slice(0, userCount);
    data.received = received.slice(0, userCount);

})();]]></script>
        <servicenow>false</servicenow>
        <sys_class_name>sp_widget</sys_class_name>
        <sys_created_by>admin</sys_created_by>
        <sys_created_on>2025-09-03 13:48:50</sys_created_on>
        <sys_id>97adb08dc3bf625075ea722ed4013189</sys_id>
        <sys_mod_count>52</sys_mod_count>
        <sys_name>Top Contributors</sys_name>
        <sys_package display_value="PeerCentral" source="x_1794402_peerce_0">b7f1c56ac397621075ea722ed40131d0</sys_package>
        <sys_policy/>
        <sys_scope display_value="PeerCentral">b7f1c56ac397621075ea722ed40131d0</sys_scope>
        <sys_update_name>sp_widget_97adb08dc3bf625075ea722ed4013189</sys_update_name>
        <sys_updated_by>admin</sys_updated_by>
        <sys_updated_on>2025-09-03 16:39:58</sys_updated_on>
        <template><![CDATA[<div class="panel panel-primary">
    <div class="panel-heading">
        <h3 class="panel-title"><i class="glyphicon glyphicon-stats"></i> Top Contributors (Last {{c.options.days}} Days)</h3>
    </div>
    <div class="panel-body pb-0">
     <nav>
      <ul class="nav nav-tabs">
        <li role="presentation" ng-class="{active: c.activeTab=='all'}">
          <a href="" ng-click="c.setTab('all')">All</a>
        </li>
        <li role="presentation" ng-class="{active: c.activeTab=='given'}">
          <a href="" ng-click="c.setTab('given')">Given</a>
        </li>
        <li role="presentation" ng-class="{active: c.activeTab=='received'}">
          <a href="" ng-click="c.setTab('received')">Received</a>
        </li>
      </ul>
  	</nav>
      
        <div class="table-responsive">
            <table class="table table-striped">
                <thead>
                    <tr>
                        <th>Team member</th>
                        <th>Recognitions</th>
                    </tr>
                </thead>
                <tbody>
                    <tr ng-repeat="user in c.data[c.activeTab]">
                      <td><a href>{{user.displayName}}</a></td>
                      <td><strong>{{user.count}}</strong></td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>

]]></template>
    </sp_widget>
    <sys_es_latest_script action="INSERT_OR_UPDATE">
        <id>97adb08dc3bf625075ea722ed4013189</id>
        <sys_created_by>admin</sys_created_by>
        <sys_created_on>2025-09-03 13:48:50</sys_created_on>
        <sys_id>1fadb08dc3bf625075ea722ed401318b</sys_id>
        <sys_mod_count>0</sys_mod_count>
        <sys_updated_by>admin</sys_updated_by>
        <sys_updated_on>2025-09-03 13:48:50</sys_updated_on>
        <table>sp_widget</table>
        <use_es_latest>true</use_es_latest>
    </sys_es_latest_script>
</record_update>
