<?xml version="1.0" encoding="UTF-8"?><record_update table="sp_widget">
    <sp_widget action="INSERT_OR_UPDATE">
        <category>custom</category>
        <client_script><![CDATA[api.controller = function($scope, $rootScope, $document, $element) {
  var c = this;

  c.dropdownVisible = false;
  c.selectedOption = {};

  c.$onInit = function() {
    if (c.data.initialSelection) {
      c.selectedOption = c.data.initialSelection;
    }
  };
	
	$scope.$on('filters.reset', function() {
		if (c.data.availableOptions && c.data.availableOptions.length > 0) {
			c.selectedOption = c.data.availableOptions[0];
		}
	});

  c.toggleDropdown = function() {
    c.dropdownVisible = !c.dropdownVisible;
  };

  c.closeDropdown = function() {
    c.dropdownVisible = false;
  };

  c.selectItem = function(item) {
    c.selectedOption = item;
    $rootScope.$broadcast(c.data.eventName, {
      selected: c.selectedOption
    });

    c.closeDropdown();
  };

  // --- Click Outside to Close ---
  var handleClickOutside = function(event) {
    var isDescendant = $element[0].contains(event.target);
    if (!isDescendant && c.dropdownVisible) {
      $scope.$apply(function() {
        c.closeDropdown();
      });
    }
  };
	
  $document.on('click', handleClickOutside);
  $scope.$on('$destroy', function() {
    $document.off('click', handleClickOutside);
  });
}]]></client_script>
        <controller_as>c</controller_as>
        <css>.single-select-filter-widget {
  position: relative;
  display: inline-block;
}

.filter-display {
  display: inline-flex;
  max-width: 100%;
  justify-content: space-between;
  align-items: center;
  border: 1px solid #ccc;
  border-radius: 6px;
  padding: 6px 12px;
  background-color: #fff;
  cursor: pointer;
  min-height: 38px;
  transition: border-color 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
}

.dropdown-open .filter-display {
  border-color: #66afe9;
  box-shadow: 0 0 4px rgba(102, 175, 233, 0.6);
}

.filter-content {
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

.filter-label {
  font-weight: 500;
  margin-right: 6px;
}

.filter-selection-text {
  font-weight: 600;
}

.filter-caret {
  margin-left: 10px;
  color: #888;
}

.dropdown-panel {
  position: absolute;
  top: 100%;
  left: 0;
  z-index: 1000;
  margin-top: 4px;
  width: 100%;
  background-color: #fff;
  border: 1px solid #ccc;
  border-radius: 6px;
  box-shadow: 0 6px 12px rgba(0,0,0,.175);
  max-height: 250px;
  overflow-y: auto;
}

.dropdown-panel .list-group {
  margin-bottom: 0;
}

.dropdown-panel .list-group-item {
  cursor: pointer;
  border: none;
  border-bottom: 1px solid #eee;
}

.dropdown-panel .list-group-item:last-child {
  border-bottom: none;
}

.dropdown-panel .list-group-item:hover {
  background-color: #f5f5f5;
}</css>
        <data_table>sp_instance</data_table>
        <demo_data/>
        <description/>
        <docs/>
        <field_list/>
        <has_preview>true</has_preview>
        <id>single-select-filter</id>
        <internal>false</internal>
        <link><![CDATA[function link(scope, element, attrs, controller) {  }]]></link>
        <name>Single Select Filter</name>
        <option_schema/>
        <public>false</public>
        <roles/>
        <script><![CDATA[
(function() {
  // Get configuration from widget options
  data.title = options.title || '';
  data.eventName = options.eventName || 'select.filter.updated';
  data.availableOptions = options.choices || [];
  data.initialSelection = options.initialSelection;

	if (data.availableOptions.length > 0) {
    data.initialSelection = data.availableOptions[0];
  }
	
})();]]></script>
        <servicenow>false</servicenow>
        <sys_class_name>sp_widget</sys_class_name>
        <sys_created_by>admin</sys_created_by>
        <sys_created_on>2025-09-20 20:40:16</sys_created_on>
        <sys_id>c8eefd66c304761075ea722ed4013196</sys_id>
        <sys_mod_count>32</sys_mod_count>
        <sys_name>Single Select Filter</sys_name>
        <sys_package display_value="PeerCentral" source="x_1794402_peerce_0">b7f1c56ac397621075ea722ed40131d0</sys_package>
        <sys_policy/>
        <sys_scope display_value="PeerCentral">b7f1c56ac397621075ea722ed40131d0</sys_scope>
        <sys_update_name>sp_widget_c8eefd66c304761075ea722ed4013196</sys_update_name>
        <sys_updated_by>admin</sys_updated_by>
        <sys_updated_on>2025-10-03 14:32:59</sys_updated_on>
        <template><![CDATA[<div class="single-select-filter-widget" ng-class="{'dropdown-open': c.dropdownVisible}">
  <div class="filter-display" ng-click="c.toggleDropdown()" title="Click to change selection">
    <div class="filter-content">
      <span class="filter-label" ng-if="c.data.title">{{c.data.title}}:</span>
      <span class="filter-selection-text" ng-bind-html="c.selectedOption.display"
        title="{{c.selectedOption.title || ''}}">
      </span>
    </div>
    <i class="fa fa-caret-down filter-caret"></i>
  </div>

  <div ng-if="c.dropdownVisible" class="dropdown-panel">
    <ul class="list-group">
      <li class="list-group-item"
        ng-repeat="item in c.data.availableOptions | filter:{value: '!' + c.selectedOption.value}"
        ng-click="c.selectItem(item)">
        <span ng-bind-html="item.display" title="{{item.title || '' }}"></span>
      </li>
    </ul>
  </div>
</div>]]></template>
    </sp_widget>
    <sys_es_latest_script action="INSERT_OR_UPDATE">
        <id>c8eefd66c304761075ea722ed4013196</id>
        <sys_created_by>admin</sys_created_by>
        <sys_created_on>2025-09-20 20:40:16</sys_created_on>
        <sys_id>40eefd66c304761075ea722ed4013199</sys_id>
        <sys_mod_count>0</sys_mod_count>
        <sys_updated_by>admin</sys_updated_by>
        <sys_updated_on>2025-09-20 20:40:16</sys_updated_on>
        <table>sp_widget</table>
        <use_es_latest>true</use_es_latest>
    </sys_es_latest_script>
</record_update>
