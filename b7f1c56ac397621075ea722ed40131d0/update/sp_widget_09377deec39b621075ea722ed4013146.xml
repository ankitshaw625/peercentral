<?xml version="1.0" encoding="UTF-8"?><record_update table="sp_widget">
    <sp_widget action="INSERT_OR_UPDATE">
        <category>custom</category>
        <client_script><![CDATA[api.controller = function($scope, $location, $timeout) {
	var c = this;
	
	c.activeTab = $location.hash() || 'you';
	c.isLoading = true;           
	c.isLoadingMore = false;
	c.canLoadMore = true;   
	
	c.offset = 0;                 
	c.limit = c.options.limit;                 
	c.data.filteredRecognitions = [];
	
	loadFeed(c.activeTab, 0, false);
	
	c.setTab = function(tabName) {
		if (c.activeTab === tabName) return; 
    $location.hash(tabName); 
	};
	
	c.loadMore = function() {
		if (!c.canLoadMore || c.isLoadingMore) return;
		
		loadFeed(c.activeTab, c.offset, true);
	};
	
	
	$scope.$on('$locationChangeSuccess', function() {
		var newTab = $location.hash();
    if (!newTab || newTab === c.activeTab) return;

    c.isLoading = true;     
    c.activeTab = newTab; 
		
		c.offset = 0; // Reset offset when switching tabs
		c.canLoadMore = true;
		loadFeed(newTab, 0, false);       
	});
	
	function loadFeed(feedType, offset, append) {
		
		if (!append) c.isLoading = true;
		if (append) c.isLoadingMore = true;
		
    c.server.get({ feedType: feedType, limit: c.limit, offset: offset, action: 'getFeed' })
        .then(function(response) {
            const newRecognitions = transformRecognitions(response.data.recognitions || []);
			
						if (append) {
							c.data.filteredRecognitions = c.data.filteredRecognitions.concat(newRecognitions);
						} else {
							c.data.filteredRecognitions = newRecognitions;
						}

						// Update offset
						c.offset += newRecognitions.length;

						// If we got fewer than limit, no more to load
						c.canLoadMore = newRecognitions.length >= c.limit;

						// Reset loading states
						c.isLoading = false;
						c.isLoadingMore = false;
        })
        .catch(function(error) {
            console.error('Failed to load feed:', error);
						if (!append) c.data.filteredRecognitions = [];
						c.isLoading = false;
						c.isLoadingMore = false;
        });
	}
	
	function transformRecognitions(recognitions) {
    return recognitions.map(function(rec) {
        return {
            ...rec,                         
            senderInitials: generateInitials(rec.senderDisplay),
            timeAgo: formatTimeAgo(rec.createdOn)
        };
    });
	}
	
	function generateInitials(name) {
    if (!name) return '?';
		
    return name.split(' ')              
               .map(part => part[0] ? part[0].toUpperCase() : '') 
               .join('')                   
               .substring(0, 2) || '?';    
	}
	
	
	function formatTimeAgo(dateTime) {
    if (!dateTime) return '';
    
    var m = moment(dateTime, "YYYY-MM-DD HH:mm:ss");
    if (!m.isValid()) return dateTime; 

		moment.updateLocale('en', {
			relativeTime: {
				future: "in %s",
				past:   "%s ago",
				s:      "a few seconds", 
				ss:     "%d seconds",    
				m:      "a minute",      
				mm:     "%d minutes",
				h:      "an hour",      
				hh:     "%d hours",
				d:      "a day",      
				dd:     "%d days",
				M:      "a month",    
				MM:     "%d months",
				y:      "a year",      
				yy:     "%d years"
			}
		});

    return m.fromNow();
	}
};]]></client_script>
        <controller_as>c</controller_as>
        <css>.nav-tabs li a:hover {
	cursor: pointer;
}

.nav-tabs &gt; li &gt; a:focus,
.nav-tabs &gt; li &gt; a:active {
  outline: none;
  box-shadow: none;
}

.nav-tabs &gt; li.active &gt; a {
  border: none;
  border-bottom: 0.2rem solid #2D7524;
}

.nav-tabs &gt; li.analytics &gt; a:focus {
	border: none;
}

/* This container is the positioning anchor for the overlay */
.feed-container {
  position: relative;
}

/* This is the spinner overlay itself */
.feed-loading-overlay {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  z-index: 10;
  display: flex;
  justify-content: center;
  
  align-items: flex-start;
  
  padding-top: 50px;
  
  background: white;
}

/* This is the list of recognitions */
.feed-content {
  opacity: 1;
  transition: opacity 0.4s linear;
}

/* This class is applied to the list when the spinner is active */
.feed-content.content-faded {
  opacity: 0;
}

.recognition-indicators abbr {
	display: inline-block;
  cursor: pointer;
}

.private-indicator {
	color: #7B6EA2;
}

.team-indicator {
	color: #007BFF;
}


.occasion-tag {
  font-size: 1rem;
  border-radius: 3px
}</css>
        <data_table>sp_instance</data_table>
        <demo_data/>
        <description/>
        <docs/>
        <field_list/>
        <has_preview>true</has_preview>
        <id>recognition_feed</id>
        <internal>false</internal>
        <link><![CDATA[function link(scope, element, attrs, controller) {  }]]></link>
        <name>Recognition Feed</name>
        <option_schema>[{"hint":"Number of records displayed in a page.","name":"limit","section":"Data","default_value":"15","label":"Record Limit","type":"integer"}]</option_schema>
        <public>false</public>
        <roles/>
        <script><![CDATA[(function() {
	
	if (input && input.action == 'getFeed') {
	
		const currentFeed = input.feedType || 'you';
		const limit = parseInt(input.limit, 10) || 15;
		const offset   = parseInt(input.offset, 10) || 0; // ]]>ðŸ‘ˆ<![CDATA[ Read offset

		const recognitionDAO = new x_1794402_peerce_0.RecognitionDAO();

		data.recognitions = recognitionDAO.getRecognitionsForFeed(currentFeed, limit, offset) || [];
		
	}

	
})();]]></script>
        <servicenow>false</servicenow>
        <sys_class_name>sp_widget</sys_class_name>
        <sys_created_by>admin</sys_created_by>
        <sys_created_on>2025-08-14 13:19:41</sys_created_on>
        <sys_id>09377deec39b621075ea722ed4013146</sys_id>
        <sys_mod_count>349</sys_mod_count>
        <sys_name>Recognition Feed</sys_name>
        <sys_package display_value="PeerCentral" source="x_1794402_peerce_0">b7f1c56ac397621075ea722ed40131d0</sys_package>
        <sys_policy/>
        <sys_scope display_value="PeerCentral">b7f1c56ac397621075ea722ed40131d0</sys_scope>
        <sys_update_name>sp_widget_09377deec39b621075ea722ed4013146</sys_update_name>
        <sys_updated_by>admin</sys_updated_by>
        <sys_updated_on>2025-09-18 20:10:49</sys_updated_on>
        <template><![CDATA[<main>
<div class="panel panel-primary">
  <!-- Default panel contents -->
  <section class="panel-heading">
  	<h3 class="panel-title">
      <strong>Recognition activity feed</strong>
    </h3>
  </section>
  
  <nav>
    <ul class="nav nav-tabs">
      <li role="presentation" ng-class="{active: c.activeTab=='you'}">
        <a href="" ng-click="c.setTab('you')">You</a>
      </li>
      
      <li role="presentation" ng-class="{active: c.activeTab=='team'}">
        <a href="" ng-click="c.setTab('team')">Team</a>
      </li>
      
      <li role="presentation" ng-class="{active: c.activeTab=='all'}">
        <a href="" ng-click="c.setTab('all')">All</a>
      </li>
      

      
    </ul>
  </nav>

  <!-- List group -->
  <section class="feed-container">
    
    <div ng-if="c.isLoading" class="feed-loading-overlay">
      <i class="fa fa-spinner fa-spin fa-2x text-muted"></i>
    </div>

    <ul class="list-group feed-content" ng-class="{'content-faded': c.isLoading}">
      <li ng-repeat="recognition in c.data.filteredRecognitions" class="list-group-item">
        <article class="media">
          
          <div class="media-left">
             <span class="fa-stack fa-lg">
                <i class="fa fa-circle fa-stack-2x text-info"></i>
                <span class="fa-stack-1x fa-inverse">{{recognition.senderInitials}}</span>
             </span>
          </div>

          <div class="media-body p-5">
            <h4 class="media-heading">
              <a href>{{recognition.senderDisplay}}</a> gave applause to <a href>{{recognition.recipients.join(', ')}}</a> 
							
              <small class="text-muted pull-right">{{recognition.timeAgo}}</small> 
              
            </h4>
            
            <span class="recognition-indicators mb-5 pull-right">
              <abbr title="Private Recognition" class="private-indicator initialism ml-10" ng-if="recognition.isPrivate">
                <i class="fa fa-lock" aria-hidden="true"></i>
              </abbr>

              <abbr  title="Team Recognition" class="team-indicator initialism ml-10" ng-if="recognition.isTeam">
                <i class="fa fa-users" aria-hidden="true"></i>
              </abbr>
            </span>
            


            <p ng-bind-html="recognition.message"></p>
            
						<span ng-repeat="occasion in recognition.occasions">
            	<small class="label label-default occasion-tag">
                <strong>{{occasion}}</strong>
              </small>&nbsp;
          	</span>
            
          </div>
        </article>
      </li>
      
      <li class="text-center">
        <div class="well well-sm text-center mb-0"> 
          <p class="text-muted small">
            Showing <strong>{{c.data.filteredRecognitions.length}}</strong> 
            {{c.data.filteredRecognitions.length === 1 ? 'recognition' : 'recognitions'}}
          </p>

          <div ng-if="c.canLoadMore">
            <button class="btn btn-primary btn-sm" ng-click="c.loadMore()" ng-disabled="c.isLoadingMore">
              <i class="fa" ng-class="{'fa-spin fa-spinner': c.isLoadingMore, 'fa-arrow-down': !c.isLoadingMore}"></i>
              {{c.isLoadingMore ? 'Loading...' : 'Load More'}}
            </button>
          </div>
          
          <p ng-if="!c.canLoadMore && c.data.filteredRecognitions.length > 0" class="text-center text-muted small m-0">
          	<em>â€” You've reached the end of the list â€”</em>
        	</p>
          
        </div>
      </li>

      <li ng-if="!c.data.filteredRecognitions.length" class="list-group-item text-center pt-20 pb-20">
        <div class="p-20"> <p class="text-muted">
            <i class="fa fa-trophy fa-3x" aria-hidden="true"></i>
          </p>
          <h4 class="text-muted">No Recognitions Found</h4>
          <p class="small text-muted">Try adjusting your filters or check back later.</p>
        </div>
      </li>

    </ul>
   </section>

 </div>
</main>]]></template>
    </sp_widget>
    <sys_es_latest_script action="INSERT_OR_UPDATE">
        <id>09377deec39b621075ea722ed4013146</id>
        <sys_created_by>admin</sys_created_by>
        <sys_created_on>2025-08-14 13:19:41</sys_created_on>
        <sys_id>8d377deec39b621075ea722ed4013148</sys_id>
        <sys_mod_count>0</sys_mod_count>
        <sys_updated_by>admin</sys_updated_by>
        <sys_updated_on>2025-08-14 13:19:41</sys_updated_on>
        <table>sp_widget</table>
        <use_es_latest>true</use_es_latest>
    </sys_es_latest_script>
</record_update>
